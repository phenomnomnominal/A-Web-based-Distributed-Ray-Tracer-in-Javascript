<!DOCTYPE html>  <html> <head>   <title>requestHandlers.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="database.html">                 database.coffee               </a>                                           <a class="source" href="index.html">                 index.coffee               </a>                                           <a class="source" href="requestHandlers.html">                 requestHandlers.coffee               </a>                                           <a class="source" href="router.html">                 router.coffee               </a>                                           <a class="source" href="sceneHandler.html">                 sceneHandler.coffee               </a>                                           <a class="source" href="server.html">                 server.coffee               </a>                                           <a class="source" href="urlShorten.html">                 urlShorten.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               requestHandlers.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p><em>requestHandlers.coffee</em> provides functions for specific operation, namely generating HTML from <a href="http://jade-lang.com/"><strong>Jade</strong></a> templates, and performing POST functionality for uploading and retrieving render operations.</p>

<hr />             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>Requires:</h2>

<p>Functionality in <em>requestHandlers.coffee</em> requires access to the following packages:</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <ul>
<li><a href="database.html"><code>database</code></a> - <em>Database functionality for insertion and retrieval of render data</em></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">database = </span><span class="nx">require</span> <span class="s">&#39;./database&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <ul>
<li><a href="sceneHandler.html"><code>sceneHandler</code></a> - <em><a href="http://www.collada.org"><strong>COLLADA</strong></a> scene description file parsing</em></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">sceneHandler = </span><span class="nx">require</span> <span class="s">&#39;./sceneHandler&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <ul>
<li><a href="urlShorten.html"><code>urlShorten</code></a> - <em>URL Shortening funcitonality</em></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">urlShorten = </span><span class="nx">require</span> <span class="s">&#39;./urlShorten&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <hr />             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <h2>Constants:</h2>

<p>Some constants are required for this script:</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <blockquote>
  <ul>
  <li><strong><code>VIEW_LOCATION</code></strong> - <em>Directory location for <a href="http://jade-lang.com/"><strong>Jade</strong></a> view templates</em></li>
  </ul>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">VIEW_LOCATION = </span><span class="nx">__dirname</span> <span class="o">+</span> <span class="s">&#39;/../../views/&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <hr />             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <h2>Functions:</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <h3><section id='master'><em>RenderMaster</em>:</section></h3>

<blockquote>
  <p><strong><code>RenderMaster</code></strong> takes the <a href="http://jade-lang.com/"><strong>Jade</strong></a> template from <em>'/views/master.jade'</em> and returns the generated HTML from the template.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">RenderMaster = </span><span class="nf">(response) -&gt;</span>
  <span class="nx">response</span><span class="p">.</span><span class="nx">render</span> <span class="nx">VIEW_LOCATION</span> <span class="o">+</span> <span class="s">&#39;master&#39;</span><span class="p">,</span> <span class="nv">title: </span><span class="s">&#39;Master&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <h3><section id='upload'><em>InsertRenderIntoDatabase</em>:</section></h3>

<blockquote>
  <p><strong><code>InsertRenderIntoDatabase</code></strong> sends the <a href="http://www.collada.org"><strong>COLLADA</strong></a> from the <code>renderUpload</code> object to <a href="sceneHandler.html"><em>sceneHandler.coffee</em></a> for parsing and inserts the resulting object into the database. A shortened URL that contains the unique identified of the render is returned to the client with the correct <code>sessionID</code>.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">InsertRenderIntoDatabase = </span><span class="nf">(response, render, sessionID) -&gt;</span>
  <span class="nv">render.sceneDescription = </span><span class="nx">sceneHandler</span><span class="p">.</span><span class="nx">parse</span> <span class="nx">render</span><span class="p">.</span><span class="nx">sceneDescription</span>
  <span class="nx">database</span><span class="p">.</span><span class="nx">insert</span> <span class="nx">render</span><span class="p">.</span><span class="nx">uuid</span><span class="p">,</span> <span class="nx">render</span>
  <span class="nx">urlShorten</span><span class="p">.</span><span class="nx">shortenURL</span> <span class="nx">render</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span> <span class="nx">sessionID</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <h3><section id='render'><em>RenderSlave</em>:</section></h3>

<blockquote>
  <p><strong><code>RenderSlave</code></strong> takes the <a href="http://jade-lang.com/"><strong>Jade</strong></a> template from <em>'/views/index.jade'</em> and returns the generated HTML from the template.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">RenderSlave = </span><span class="nf">(response) -&gt;</span>
  <span class="nx">response</span><span class="p">.</span><span class="nx">render</span> <span class="nx">VIEW_LOCATION</span> <span class="o">+</span> <span class="s">&#39;index&#39;</span><span class="p">,</span> <span class="nv">title: </span><span class="s">&#39;Slave&#39;</span>
  </pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <h3><section id='get-render'><em>GetRenderFromDatabase</em>:</section></h3>

<blockquote>
  <p><strong><code>GetRenderFromDatabase</code></strong> searches the database for the render described by the <code>getRender</code> object and returns it to the client with the correct <code>sessionID</code>.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">GetRenderFromDatabase = </span><span class="nf">(response, getRender, sessionID) -&gt;</span>
  <span class="nx">database</span><span class="p">.</span><span class="nx">find</span> <span class="nx">getRender</span><span class="p">.</span><span class="nx">renderId</span><span class="p">,</span> <span class="nx">sessionID</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <h3><section id='test'><em>RenderTest</em>:</section></h3>

<blockquote>
  <p><strong><code>RenderTest</code></strong> takes the <a href="http://jade-lang.com/"><strong>Jade</strong></a> template from <em>'/views/test.jade'</em> and returns the generated HTML from the template.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">RenderTest = </span><span class="nf">(response) -&gt;</span>
  <span class="nx">response</span><span class="p">.</span><span class="nx">render</span> <span class="nx">VIEW_LOCATION</span> <span class="o">+</span> <span class="s">&#39;test&#39;</span><span class="p">,</span> <span class="nv">layout: </span><span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <hr />

<h2>Exports:</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>The <a href="#master"><strong><code>RenderMaster</code></strong></a>, <a href="#insert"><strong><code>InsertRenderIntoDatabase</code></strong></a>, <a href="#render"><strong><code>RenderSlave</code></strong></a>, <a href="#get-render"><strong><code>GetRenderFromDatabase</code></strong></a> and <a href="#test"><strong><code>RenderTest</code></strong></a> functions are added to the global <code>root</code> object.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">root = </span><span class="nx">exports</span> <span class="o">?</span> <span class="k">this</span>
<span class="nv">root.master = </span><span class="nx">RenderMaster</span>
<span class="nv">root.upload = </span><span class="nx">InsertRenderIntoDatabase</span>
<span class="nv">root.render = </span><span class="nx">RenderSlave</span>
<span class="nv">root.getRender = </span><span class="nx">GetRenderFromDatabase</span>
<span class="nv">root.test = </span><span class="nx">RenderTest</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 