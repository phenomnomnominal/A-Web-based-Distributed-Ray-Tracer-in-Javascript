<!DOCTYPE html>  <html> <head>   <title>geometry.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               geometry.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p><em>geometry.coffee</em> contains mathematical representations of geometric constructs, specifically:</p>

<ul>
<li><p><a href="#vector"><strong><code>Vector</code></strong></a></p></li>
<li><p><a href="#point"><strong><code>Point</code></strong></a></p></li>
<li><p><a href="#normal"><strong><code>Normal</code></strong></a></p></li>
<li><p><a href="#ray"><strong><code>Ray</code></strong></a></p></li>
<li><p><a href="#raydiff"><strong><code>RayDifferential</code></strong></a></p></li>
<li><p><a href="#bbox"><strong><code>BoundingBox</code></strong></a></p></li>
</ul>

<hr />             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2><section id="vector">Vector:<section></h2>

<hr />

<p>A <strong><code>Vector</code></strong> represents a direction in 3D space, as an <em>X</em> component, <em>Y</em> component and <em>Z</em> component.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Vector</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <hr />

<h3>Constructor Functions:</h3>             </td>             <td class="code">               <div class="highlight"><pre>  </pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h3><em>constructor:</em></h3>

<blockquote>
  <p>The standard <strong><code>Vector</code></strong> constructor takes up to three numbers as parameters, representing the <em>X</em>, <em>Y</em> and <em>Z</em> components respectively. Any component that is not set, becomes <code>0</code> by default, therefore, if no arguments are provided, a null <strong><code>Vector</code></strong> is initialised:</p>
  
  <blockquote>
    <p><em>v = (0, 0, 0)</em></p>
  </blockquote>
  
  <p>If any of the components is <code>NaN</code>, an error is thrown.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">constructor: </span><span class="nf">(@x = 0, @y = 0, @z = 0) -&gt;</span>
    <span class="k">if</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">@x</span><span class="p">)</span> <span class="o">or</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">@y</span><span class="p">)</span> <span class="o">or</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">@z</span><span class="p">)</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s">&quot;Vector contains a NaN&quot;</span>
  </pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <h3><em>Vector.FromNormal:</em></h3>

<blockquote>
  <p>The <strong><code>Vector</code></strong> class provides a static function for initialising a <strong><code>Vector</code></strong> from an instance of the <a href="#normal"><strong><code>Normal</code></strong></a> class.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@FromNormal: </span><span class="nf">(n) -&gt;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Vector</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">n</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">n</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h3><em>Vector.FromPoint:</em></h3>

<blockquote>
  <p>The <strong>Vector</strong> class provides a static function for initialising a <strong><code>Vector</code></strong> from an instance of the <a href="#point"><strong><code>Point</code></strong></a> class.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@FromPoint: </span><span class="nf">(p) -&gt;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Vector</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <h3><em>Vector.FromVector:</em></h3>

<blockquote>
  <p>The <strong><code>Vector</code></strong> class provides a static function for initialising a <strong><code>Vector</code></strong> from another instance  of the <strong><code>Vector</code></strong> class.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@FromVector: </span><span class="nf">(v) -&gt;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Vector</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span>
    </pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <hr />

<h3>Prototypical Instance Functions:</h3>             </td>             <td class="code">               <div class="highlight"><pre>  </pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>These functions are attached to each instance of the <strong><code>Vector</code></strong> class - changing the function of one <strong><code>Vector</code></strong> changes the function on all other <strong><code>Vector</code></strong>s as well. These functions act on a <strong><code>Vector</code></strong> instance in place - the original object is modified.</p>             </td>             <td class="code">               <div class="highlight"><pre>  </pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <h3><strong>Arithmetic methods:</strong></h3>

<p>Arithmetic with <strong><code>Vector</code></strong> instances is performed component-wise, for example:</p>

<blockquote>
  <p><em>v + v' = (v.x + v'.x), (v.y + v'.y), (v.z + v'.z)</em></p>
  
  <p><em>v × 3' = (v.x × 3), (v.y × 3), (v.z × 3)</em></p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  </pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <blockquote>
  <h3><section id='vector-add'><em>add:</em></section></h3>
  
  <blockquote>
    <p><strong><code>add</code></strong> adds each of the <em>X</em>, <em>Y</em> and <em>Z</em> components of another <strong><code>Vector</code></strong> to the corresponding components of an instance of the <strong><code>Vector</code></strong> class.</p>
  </blockquote>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">add: </span><span class="nf">(v) -&gt;</span>
    <span class="nx">@x</span> <span class="o">+=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">x</span>
    <span class="nx">@y</span> <span class="o">+=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span>
    <span class="nx">@z</span> <span class="o">+=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span>
    <span class="k">return</span> <span class="nx">@</span>
  </pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <blockquote>
  <h3><section id='vector-subtract'><em>subtract:</em></section></h3>
  
  <blockquote>
    <p><strong><code>subtract</code></strong> subtracts each of the <em>X</em>, <em>Y</em> and <em>Z</em> components of another <strong><code>Vector</code></strong> from the corresponding components of an instance of the <strong><code>Vector</code></strong> class.</p>
  </blockquote>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">subtract: </span><span class="nf">(v) -&gt;</span>
    <span class="nx">@x</span> <span class="o">-=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">x</span>
    <span class="nx">@y</span> <span class="o">-=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span>
    <span class="nx">@z</span> <span class="o">-=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span>
    <span class="k">return</span> <span class="nx">@</span>
  </pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <blockquote>
  <h3><section id='vector-multiply'><em>multiply:</em></section></h3>
  
  <blockquote>
    <p><strong><code>multiply</code></strong> multiplies each of the <em>X</em>, <em>Y</em> and <em>Z</em> components of an instance of the <strong><code>Vector</code></strong> class by a given scalar.</p>
  </blockquote>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">multiply: </span><span class="nf">(scale) -&gt;</span>
    <span class="nx">@x</span> <span class="o">*=</span> <span class="nx">scale</span>
    <span class="nx">@y</span> <span class="o">*=</span> <span class="nx">scale</span>
    <span class="nx">@z</span> <span class="o">*=</span> <span class="nx">scale</span>
    <span class="k">return</span> <span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <blockquote>
  <h3><section id='vector-divide'><em>divide:</em></section></h3>
  
  <blockquote>
    <p><strong><code>divide</code></strong> divides each of the <em>X</em>, <em>Y</em> and <em>Z</em> components of an instance of the <strong><code>Vector</code></strong> class by a given scalar.</p>
    
    <p>An error is thrown if the scalar is <code>0</code>.</p>
    
    <p>One division and three multiplications are performed instead of three divisions for efficiency.</p>
  </blockquote>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">divide: </span><span class="nf">(scale) -&gt;</span>
    <span class="k">if</span> <span class="nx">scale</span> <span class="o">is</span> <span class="mi">0</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s">&quot;Scale value is 0&quot;</span>
    <span class="nv">inv = </span><span class="mi">1</span> <span class="o">/</span> <span class="nx">scale</span>
    <span class="nx">@x</span> <span class="o">*=</span> <span class="nx">inv</span>
    <span class="nx">@y</span> <span class="o">*=</span> <span class="nx">inv</span>
    <span class="nx">@z</span> <span class="o">*=</span> <span class="nx">inv</span>
    <span class="k">return</span> <span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <h3><em>toArray:</em></h3>

<blockquote>
  <p><strong><code>toArray</code></strong> returns a <strong><code>Vector</code></strong> instance as an <code>Array</code> object of the form <code>[X, Y, Z]</code>.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">toArray: </span><span class="o">-&gt;</span>
    <span class="k">return</span> <span class="p">[</span><span class="nx">@x</span><span class="p">,</span> <span class="nx">@y</span><span class="p">,</span> <span class="nx">@z</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <h3><em>equals:</em></h3>

<blockquote>
  <p><strong><code>equals</code></strong> checks a <strong><code>Vector</code></strong> for equality with another <strong><code>Vector</code></strong>. Two <strong><code>Vector</code></strong> instances are equal if each of their <em>X</em>, <em>Y</em> and <em>Z</em> components are the same.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">equals: </span><span class="nf">(v) -&gt;</span>
    <span class="k">if</span> <span class="nx">v</span><span class="p">.</span><span class="nx">constructor</span><span class="o">?</span> <span class="o">and</span> <span class="nx">v</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">name</span> <span class="o">is</span> <span class="s">&quot;Vector&quot;</span> 
      <span class="k">return</span> <span class="nx">@x</span> <span class="o">is</span> <span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">and</span> <span class="nx">@y</span> <span class="o">is</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">and</span> <span class="nx">@z</span> <span class="o">is</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span>
    <span class="k">return</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <hr />

<h3>Static Functions:</h3>             </td>             <td class="code">               <div class="highlight"><pre>      </pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>These functions belong to the <strong><code>Vector</code></strong> class - any object arguments are not 
modified and a new object is always returned.</p>             </td>             <td class="code">               <div class="highlight"><pre>  </pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <h3><strong>Arithmetic methods:</strong></h3>

<p>Static implementations of basic arithmetic functions are also available. These functions
operate on existing <strong><code>Vector</code></strong> instances.</p>             </td>             <td class="code">               <div class="highlight"><pre>      </pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <blockquote>
  <h3><section id='vector-Add'><em>Vector.Add:</em></section></h3>
  
  <blockquote>
    <p><strong><code>Vector.Add</code></strong> adds each of the <em>X</em>, <em>Y</em> and <em>Z</em> components of another <strong><code>Vector</code></strong> to the corresponding components of an instance of the <strong><code>Vector</code></strong> class.</p>
  </blockquote>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@Add: </span><span class="nf">(v1, v2) -&gt;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Vector</span><span class="p">(</span><span class="nx">v1</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">v2</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v1</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">v2</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v1</span><span class="p">.</span><span class="nx">z</span> <span class="o">+</span> <span class="nx">v2</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span>    
 </pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <blockquote>
  <h3><section id='vector-Subtract'><em>Vector.Subtract:</em></section></h3>
  
  <blockquote>
    <p><strong><code>Vector.Subtract</code></strong> subtracts each of the <em>X</em>, <em>Y</em> and <em>Z</em> components of another <strong><code>Vector</code></strong> from the corresponding components of an instance of the <strong><code>Vector</code></strong> class.</p>
  </blockquote>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@Subtract: </span><span class="nf">(v1, v2) -&gt;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Vector</span><span class="p">(</span><span class="nx">v1</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">v2</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v1</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">v2</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v1</span><span class="p">.</span><span class="nx">z</span> <span class="o">-</span> <span class="nx">v2</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span>
    </pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <blockquote>
  <h3><section id='vector-Multiply'><em>Vector.Multiply:</em></section></h3>
  
  <blockquote>
    <p><strong><code>Vector.Multiply</code></strong> multiplies each of the <em>X</em>, <em>Y</em> and <em>Z</em> components of an instance of the <strong><code>Vector</code></strong> class by a given scalar.</p>
  </blockquote>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@Multiply: </span><span class="nf">(v, scale) -&gt;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Vector</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">scale</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">scale</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="nx">scale</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <blockquote>
  <h3><section id='vector-Divide'><em>Vector.Divide:</em></section></h3>
  
  <blockquote>
    <p><strong><code>Vector.Divide</code></strong> divides each of the <em>X</em>, <em>Y</em> and <em>Z</em> components of an instance of the <strong><code>Vector</code></strong> class by a given scalar.</p>
    
    <p>An error is thrown if the scalar is <code>0</code>.</p>
    
    <p>One division and three multiplications are performed instead of three divisions for efficiency.</p>
  </blockquote>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@Divide: </span><span class="nf">(v, scale) -&gt;</span>
    <span class="k">if</span> <span class="nx">scale</span> <span class="o">is</span> <span class="mi">0</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s">&quot;Scale value is 0&quot;</span>
    <span class="nv">inv = </span><span class="mi">1</span> <span class="o">/</span> <span class="nx">scale</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Vector</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">inv</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">inv</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="nx">inv</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <h3><em>Vector.Negate:</em></h3>

<blockquote>
  <p><strong><code>Vector.Negate</code></strong> returns a <strong><code>Vector</code></strong> that points in the opposite direction to the given <strong><code>Vector</code></strong>, by negating each of the <em>X</em>, <em>Y</em> and <em>Z</em> components.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@Negate: </span><span class="nf">(v) -&gt;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Vector</span><span class="p">(</span><span class="o">-</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="o">-</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="o">-</span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span>
    </pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <h3><em>Vector.Equals:</em></h3>

<blockquote>
  <p><strong><code>Vector.Equals</code></strong> checks a <strong><code>Vector</code></strong> for equality with another <strong><code>Vector</code></strong>. Two <strong><code>Vector</code></strong> instances are equal if each of their <em>X</em>, <em>Y</em> and <em>Z</em> components are the same.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@Equals: </span><span class="nf">(v1, v2) -&gt;</span>
    <span class="k">if</span> <span class="nx">v1</span><span class="p">.</span><span class="nx">constructor</span><span class="o">?</span> <span class="o">and</span> <span class="nx">v1</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">name</span> <span class="o">is</span> <span class="s">&quot;Vector&quot;</span> <span class="o">and</span> <span class="nx">v2</span><span class="p">.</span><span class="nx">constructor</span><span class="o">?</span> <span class="o">and</span> <span class="nx">v2</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">name</span> <span class="o">is</span> <span class="s">&quot;Vector&quot;</span>
      <span class="k">return</span> <span class="nx">v1</span><span class="p">.</span><span class="nx">x</span> <span class="o">is</span> <span class="nx">v2</span><span class="p">.</span><span class="nx">x</span> <span class="o">and</span> <span class="nx">v1</span><span class="p">.</span><span class="nx">y</span> <span class="o">is</span> <span class="nx">v2</span><span class="p">.</span><span class="nx">y</span> <span class="o">and</span> <span class="nx">v1</span><span class="p">.</span><span class="nx">z</span> <span class="o">is</span> <span class="nx">v2</span><span class="p">.</span><span class="nx">z</span>
    <span class="k">return</span> <span class="kc">false</span>
  </pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <h3><em>Vector.Clone:</em></h3>

<blockquote>
  <p><strong><code>Vector.Clone</code></strong> creates an exact copy of a <strong><code>Vector</code></strong>. A Class specific function is used for improved efficiency.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@Clone: </span><span class="nf">(v) -&gt;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Vector</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <h3><section id='vector-Dot'><em>Vector.Dot:</em></section></h3>

<blockquote>
  <p><strong><code>Vector.Dot</code></strong> computes the <a href="http://en.wikipedia.org/wiki/Dot_product"><strong>Dot Product</strong></a> of two <strong><code>Vector</code></strong> instances - or a <strong><code>Vector</code></strong> and a <strong><code>Normal</code></strong>. The <strong>Dot Product</strong> is defined for <em>a</em> and <em>b</em> as:</p>
  
  <blockquote>
    <p><em>(a.x × b.x) + (a.y × b.y) + (a.z × b.z).</em></p>
  </blockquote>
  
  <p>The <strong>Dot Product</strong> has a simple relationship to the angle between two <strong><code>Vector</code></strong> instances:</p>
  
  <blockquote>
    <p><em>(a &sdot; b) = || a || × || b || × cos(&theta;).</em></p>
  </blockquote>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@Dot: </span><span class="nf">(a, b) -&gt;</span>
    <span class="k">return</span> <span class="nx">a</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">b</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">a</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">b</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">a</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="nx">b</span><span class="p">.</span><span class="nx">z</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <h3><em>Vector.AbsDot:</em></h3>

<blockquote>
  <p><strong><code>Vector.AbsDot</code></strong> computes the <a href="http://en.wikipedia.org/wiki/Absolute_value"><strong>Absolute Value</strong></a> of the <strong>Dot Product</strong> of two <strong><code>Vector</code></strong> instances - or a <strong><code>Vector</code></strong> and a <strong><code>Normal</code></strong>.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@AbsDot: </span><span class="nf">(a, b) -&gt;</span>
    <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span> <span class="nx">Vector</span><span class="p">.</span><span class="nx">Dot</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <h3><em>Vector.Cross:</em></h3>

<blockquote>
  <p><strong><code>Vector.Cross</code></strong> computes the <a href="http://en.wikipedia.org/wiki/Cross_product"><strong>Cross Product</strong></a> of two <strong><code>Vector</code></strong> instances - or a <strong><code>Vector</code></strong> and a <strong><code>Normal</code></strong>. The <strong>Cross Product</strong> is defined for <em>a</em> and <em>b</em> as:</p>
  
  <blockquote>
    <p><em>|| (a x b) || = || a || × || b || × sin(&theta;).</em></p>
  </blockquote>
  
  <p>The cross product of two <strong><code>Vector</code></strong> instances is orthogonal to both.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@Cross: </span><span class="nf">(a, b) -&gt;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Vector</span><span class="p">((</span><span class="nx">a</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">b</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="nx">b</span><span class="p">.</span><span class="nx">y</span><span class="p">),</span> 
                      <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="nx">b</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">b</span><span class="p">.</span><span class="nx">z</span><span class="p">),</span> 
                      <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">b</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">b</span><span class="p">.</span><span class="nx">x</span><span class="p">))</span>
  </pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <h3><em>Vector.Normalise:</em></h3>

<blockquote>
  <p><strong><code>Vector.Normalise</code></strong> normalises a <strong><code>Vector</code></strong>, returning a <strong><code>Vector</code></strong> that points in the same direction, but is of unit length.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@Normalise: </span><span class="nf">(v) -&gt;</span>
    <span class="k">return</span> <span class="nx">Vector</span><span class="p">.</span><span class="nx">Divide</span> <span class="nx">v</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">v</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <h3><em>Vector.CoodinateSystem</em>:</h3>

<blockquote>
  <p><strong><code>Vector.CoordinateSystem</code></strong> takes a single normalised <strong><code>Vector</code></strong> and generates three <strong><code>Vector</code></strong>  instances that form a coordinate system local to the original <strong><code>Vector</code></strong>.</p>
  
  <p>First, a <strong><code>Vector</code></strong> (<em>v<sub>2</sub></em>) that is perpendicular to the original <strong><code>Vector</code></strong> (<em>v<sub>1</sub></em>) is created by zeroing one of the components, swapping the remaining two, and negating one of them.</p>
  
  <p>Then <em>v<sub>3</sub></em> is generated as the <strong>Cross Product</strong> of <em>v<sub>1</sub></em> and <em>v<sub>2</sub></em>, which by definition will be perpendicular to <em>v<sub>1</sub></em> and <em>v<sub>2</sub></em>.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@CoordinateSystem: </span><span class="nf">(v1) -&gt;</span>
    <span class="k">if</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span> <span class="nx">v1</span><span class="p">.</span><span class="nx">x</span> <span class="o">&gt;</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span> <span class="nx">v1</span><span class="p">.</span><span class="nx">y</span>
      <span class="nv">invLength = </span><span class="mi">1</span> <span class="o">/</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">v1</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">v1</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">v1</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="nx">v1</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span>
      <span class="nv">v2 = </span><span class="k">new</span> <span class="nx">Vector</span><span class="p">(</span><span class="o">-</span><span class="nx">v1</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="nx">invLength</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">v1</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">invLength</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nv">invLength = </span><span class="mi">1</span> <span class="o">/</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">v1</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">v1</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">v1</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="nx">v1</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span>
      <span class="nv">v2 = </span><span class="k">new</span> <span class="nx">Vector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">v1</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="nx">invLength</span><span class="p">,</span> <span class="o">-</span><span class="nx">v1</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">invLength</span><span class="p">)</span>
    <span class="nv">v3 = </span><span class="nx">Vector</span><span class="p">.</span><span class="nx">Cross</span> <span class="nx">v1</span><span class="p">,</span> <span class="nx">v2</span>
    <span class="k">return</span> <span class="p">[</span><span class="nx">v1</span><span class="p">,</span> <span class="nx">v2</span><span class="p">,</span> <span class="nx">v3</span><span class="p">]</span>
    </pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <hr />             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <h2><section id="point">Point:</section></h2>

<hr />

<p>A <strong>Point</strong> represents a zero-dimensional point in 3D space, as an <em>X</em> component, <em>Y</em> component and <em>Z</em> component.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Point</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <hr />

<h3>Constructor Functions:</h3>             </td>             <td class="code">               <div class="highlight"><pre>  </pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <h3><em>constructor:</em></h3>

<blockquote>
  <p>The standard <strong><code>Point</code></strong> constructor takes up to three numbers, representing the <em>X</em>, <em>Y</em> and <em>Z</em> components respectively. Any component that is not set, becomes <code>0</code> by default, therefore, if no arguments are provided, a null <strong><code>Point</code></strong> is initialised:
     <em>p = (0, 0, 0)</em></p>
  
  <p>If any of the components is <code>NaN</code>, an error is thrown.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">constructor: </span><span class="nf">(@x = 0, @y = 0, @z = 0) -&gt;</span>
    <span class="k">if</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">@x</span><span class="p">)</span> <span class="o">or</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">@y</span><span class="p">)</span> <span class="o">or</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">@z</span><span class="p">)</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s">&quot;Point contains a NaN&quot;</span>
    </pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <h3><em>Point.FromPoint:</em></h3>

<blockquote>
  <p>The <strong><code>Point</code></strong> class provides a static function for initialising a <strong><code>Point</code></strong> from another instance of the <strong><code>Point</code></strong> class.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@FromPoint: </span><span class="nf">(p) -&gt;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span>
    </pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <hr />

<h3>Prototypical Instance Functions:</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>These functions are attached to each instance of the <strong><code>Point</code></strong> class - changing the function of one <strong><code>Point</code></strong> changes the function on all other <strong><code>Point</code></strong>s as well. These functions act on a <strong><code>Point</code></strong> instance in-place - the original object is modified.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <h3><strong>Arithmetic methods:</strong></h3>

<p>Arithmetic with <strong>Point</strong> instances is performed component-wise, for example:</p>

<blockquote>
  <p><em>p + p' = (p.x + p'.x), (p.y + p'.y), (p.z + p'.z)</em></p>
  
  <p><em>p × 3' = (p.x × 3), (p.y × 3), (p.z × 3)</em></p>
</blockquote>

<p>Certain arithmetic operations on <strong><code>Point</code></strong> instances can take or return a <a href="#vector"><strong><code>Vector</code></strong></a>. For instance, adding a <strong><code>Vector</code></strong> to a <strong><code>Point</code></strong> returns the <strong><code>Point</code></strong> offset by the <strong><code>Vector</code></strong>, or subtracting a <strong><code>Point</code></strong> from a <strong><code>Point</code></strong> returns the <strong><code>Vector</code></strong> between them.</p>             </td>             <td class="code">               <div class="highlight"><pre>  </pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <blockquote>
  <h3><em>addPoint:</em></h3>
  
  <blockquote>
    <p><strong><code>addPoint</code></strong> adds each of the <em>X</em>, <em>Y</em> and <em>Z</em> components of another <strong><code>Point</code></strong> to the corresponding components of an instance of the <strong><code>Point</code></strong> class.</p>
  </blockquote>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">addPoint: </span><span class="nf">(p) -&gt;</span>
    <span class="nx">@x</span> <span class="o">+=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span>
    <span class="nx">@y</span> <span class="o">+=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span>
    <span class="nx">@z</span> <span class="o">+=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span>
    <span class="k">return</span> <span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <blockquote>
  <h3><em>addVector:</em></h3>
  
  <blockquote>
    <p><strong><code>addVector</code></strong> adds each of the <em>X</em>, <em>Y</em> and <em>Z</em> components of a <strong><code>Vector</code></strong> to the corresponding components of an instance of the <strong><code>Point</code></strong> class.</p>
  </blockquote>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">addVector: </span><span class="nf">(v) -&gt;</span>
    <span class="nx">@x</span> <span class="o">+=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">x</span>
    <span class="nx">@y</span> <span class="o">+=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span>
    <span class="nx">@z</span> <span class="o">+=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span>
    <span class="k">return</span> <span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <blockquote>
  <h3><em>subtractVector:</em></h3>
  
  <blockquote>
    <p><strong><code>subtractVector</code></strong> subtracts each of the <em>X</em>, <em>Y</em> and <em>Z</em> components of a <strong><code>Vector</code></strong> from the corresponding components of an instance of the <strong><code>Point</code></strong> class.</p>
  </blockquote>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">subtractVector: </span><span class="nf">(v) -&gt;</span>
    <span class="nx">@x</span> <span class="o">-=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">x</span>
    <span class="nx">@y</span> <span class="o">-=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span>
    <span class="nx">@z</span> <span class="o">-=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span>
    <span class="k">return</span> <span class="nx">@</span>
    </pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <blockquote>
  <h3><em>multiply:</em></h3>
  
  <blockquote>
    <p><strong><code>multiply</code></strong> multiplies each of the <em>X</em>, <em>Y</em> and <em>Z</em> components of an instance of the <strong><code>Point</code></strong> class by a given scalar.</p>
  </blockquote>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">multiply: </span><span class="nf">(scale) -&gt;</span>
    <span class="nx">@x</span> <span class="o">*=</span> <span class="nx">scale</span>
    <span class="nx">@y</span> <span class="o">*=</span> <span class="nx">scale</span>
    <span class="nx">@z</span> <span class="o">*=</span> <span class="nx">scale</span>
    <span class="k">return</span> <span class="nx">@</span>
    </pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <blockquote>
  <h3><em>divide:</em></h3>
  
  <blockquote>
    <p><strong><code>divide</code></strong> divide each of the <em>X</em>, <em>Y</em> and <em>Z</em> components of an instance of the <strong><code>Point</code></strong> class by a given scalar.</p>
  </blockquote>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">divide: </span><span class="nf">(scale) -&gt;</span>
    <span class="k">if</span> <span class="nx">scale</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s">&quot;Scale value is 0&quot;</span>
    <span class="nv">inv = </span><span class="mi">1</span> <span class="o">/</span> <span class="nx">scale</span>
    <span class="k">return</span> <span class="nx">@</span><span class="p">.</span><span class="nx">multiply</span> <span class="nx">inv</span>
    </pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <h3><em>toArray:</em></h3>

<blockquote>
  <p><strong><code>toArray</code></strong> returns a <strong><code>Point</code></strong> instance as an <code>Array</code> object of the form <code>[X, Y, Z]</code>.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">toArray: </span><span class="o">-&gt;</span>
    <span class="k">return</span> <span class="p">[</span><span class="nx">@x</span><span class="p">,</span> <span class="nx">@y</span><span class="p">,</span> <span class="nx">@z</span><span class="p">]</span>
  </pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <h3><em>equals:</em></h3>

<blockquote>
  <p><strong><code>equals</code></strong> checks a <strong><code>Point</code></strong> for equality with another <strong><code>Point</code></strong>. Two <strong><code>Point</code></strong> instances are equal if each of their <em>X</em>, <em>Y</em> and <em>Z</em> components are the same.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">equals: </span><span class="nf">(p) -&gt;</span>
    <span class="k">if</span> <span class="nx">p</span><span class="p">.</span><span class="nx">constructor</span><span class="o">?</span> <span class="o">and</span> <span class="nx">p</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">name</span> <span class="o">is</span> <span class="s">&quot;Point&quot;</span>
      <span class="k">return</span> <span class="nx">@x</span> <span class="o">is</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span> <span class="o">and</span> <span class="nx">@y</span> <span class="o">is</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span> <span class="o">and</span> <span class="nx">@z</span> <span class="o">is</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span>
    <span class="k">else</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <hr />

<h3>Static Functions:</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>These functions belong to the <strong><code>Point</code></strong> class - any object arguments are not modified and a new object is always returned.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <h3><strong>Arithmetic methods</strong></h3>

<p>Static implementations of basic arithmetic functions are also available. These functions
operate on existing <strong><code>Point</code></strong> instances.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <blockquote>
  <h3><em>Point.AddPointToPoint:</em></h3>
  
  <blockquote>
    <p><strong><code>Point.AddPointToPoint</code></strong> adds each of the <em>X</em>, <em>Y</em> and <em>Z</em> components of a given <strong><code>Point</code></strong> to the corresponding components of another <strong><code>Point</code></strong>, and returns a new <strong><code>Point</code></strong>.</p>
  </blockquote>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@AddPointToPoint: </span><span class="nf">(p1, p2) -&gt;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">p2</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p1</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">p2</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">p1</span><span class="p">.</span><span class="nx">z</span> <span class="o">+</span> <span class="nx">p2</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <blockquote>
  <h3><em>Point.AddVectorToPoint:</em></h3>
  
  <blockquote>
    <p><strong><code>Point.AddVectorToPoint</code></strong> adds each of the <em>X</em>, <em>Y</em> and <em>Z</em> components of a <strong><code>Vector</code></strong> to the corresponding components of a <strong><code>Point</code></strong> and returns a new <strong><code>Point</code></strong>, which is the <strong><code>Point</code></strong> shifted in 3D space by the <strong><code>Vector</code></strong>.</p>
  </blockquote>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@AddVectorToPoint: </span><span class="nf">(p, v) -&gt;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <blockquote>
  <h3><em>Point.SubtractPointFromPoint:</em></h3>
  
  <blockquote>
    <p><strong><code>Point.SubtractPointFromPoint</code></strong> subtracts each of the <em>X</em>, <em>Y</em> and <em>Z</em> components of a given <strong><code>Point</code></strong> from the corresponding components of another <strong><code>Point</code></strong> and returns a new <strong><code>Vector</code></strong>, which is the <strong><code>Vector</code></strong> between the two.</p>
  </blockquote>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@SubtractPointFromPoint: </span><span class="nf">(p1, p2) -&gt;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Vector</span><span class="p">(</span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">p2</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p1</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">p2</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">p1</span><span class="p">.</span><span class="nx">z</span> <span class="o">-</span> <span class="nx">p2</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <blockquote>
  <h3><em>Point.SubtractVectorFromPoint:</em></h3>
  
  <blockquote>
    <p><strong><code>Point.SubtractVectorFromPoint</code></strong> subtracts each of the <em>X</em>, <em>Y</em> and <em>Z</em> components of a given <strong><code>Vector</code></strong> from the corresponding components of a <strong><code>Point</code></strong> and returns a new <strong><code>Point</code></strong>, which is the given <strong><code>Point</code></strong> shifted in 3D space by the negated version of the given <strong><code>Vector</code></strong>.</p>
  </blockquote>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@SubtractVectorFromPoint: </span><span class="nf">(p, v) -&gt;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span> <span class="o">-</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <blockquote>
  <h3><em>Point.Multiply:</em></h3>
  
  <blockquote>
    <p><strong><code>Point.Multiply</code></strong> multiplies each of the <em>X</em>, <em>Y</em> and <em>Z</em> components of an instance of the <strong><code>Point</code></strong> class by a given scalar.</p>
  </blockquote>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@Multiply: </span><span class="nf">(p, scale) -&gt;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">scale</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">scale</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="nx">scale</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <blockquote>
  <h3><em>Point.Divide:</em></h3>
  
  <blockquote>
    <p><strong><code>Point.Divide</code></strong> divide each of the <em>X</em>, <em>Y</em> and <em>Z</em> components of an instance of the <strong><code>Point</code></strong> class by a given scalar.</p>
  </blockquote>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@Divide: </span><span class="nf">(p, scale) -&gt;</span>
    <span class="k">if</span> <span class="nx">scale</span> <span class="o">is</span> <span class="mi">0</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s">&quot;Scale value is 0&quot;</span>
    <span class="nv">inv = </span><span class="mi">1</span> <span class="o">/</span> <span class="nx">scale</span>
    <span class="k">return</span> <span class="nx">Point</span><span class="p">.</span><span class="nx">Multiply</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">inv</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <h3><em>Point.Equals:</em></h3>

<blockquote>
  <p><strong><code>Point.Equals</code></strong> checks a <strong><code>Point</code></strong> for equality with another <strong><code>Point</code></strong>. Two <strong><code>Point</code></strong> instances are equal if each of their <em>X</em>, <em>Y</em> and <em>Z</em> components are the same.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@Equals: </span><span class="nf">(p1, p2) -&gt;</span>
    <span class="k">if</span> <span class="nx">p1</span><span class="p">.</span><span class="nx">constructor</span><span class="o">?</span> <span class="o">and</span> <span class="nx">p1</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">name</span> <span class="o">is</span> <span class="s">&quot;Point&quot;</span> <span class="o">and</span> <span class="nx">p2</span><span class="p">.</span><span class="nx">constructor</span><span class="o">?</span> <span class="o">and</span> <span class="nx">p2</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">name</span> <span class="o">is</span> <span class="s">&quot;Point&quot;</span>
      <span class="k">return</span> <span class="nx">p1</span><span class="p">.</span><span class="nx">x</span> <span class="o">is</span> <span class="nx">p2</span><span class="p">.</span><span class="nx">x</span> <span class="o">and</span> <span class="nx">p1</span><span class="p">.</span><span class="nx">y</span> <span class="o">is</span> <span class="nx">p2</span><span class="p">.</span><span class="nx">y</span> <span class="o">and</span> <span class="nx">p1</span><span class="p">.</span><span class="nx">z</span> <span class="o">is</span> <span class="nx">p2</span><span class="p">.</span><span class="nx">z</span>
    <span class="k">return</span> <span class="kc">false</span>
    </pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <h3><em>Point.Clone:</em></h3>

<blockquote>
  <p><strong><code>Point.Clone</code></strong> creates an exact copy of a <strong><code>Point</code></strong>. A Class specific function is used for improved efficiency.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@Clone: </span><span class="nf">(p) -&gt;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span>
    </pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <h3><em>Point.Distance:</em></h3>

<blockquote>
  <p><strong><code>Point.Distance</code></strong> finds the distance between two <strong><code>Point</code></strong>s by subtracting them and finding the length of the resulting <strong><code>Vector</code></strong>.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@Distance: </span><span class="nf">(p1, p2) -&gt;</span>
    <span class="nv">v = </span><span class="nx">Point</span><span class="p">.</span><span class="nx">SubtractPointFromPoint</span> <span class="nx">p1</span><span class="p">,</span> <span class="nx">p2</span>
    <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
  </pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <h3><em>Point.DistanceSquared:</em></h3>

<blockquote>
  <p><strong><code>Point.DistanceSquared</code></strong> finds the square of the distance between <strong>Point</strong>s by subtracting them, and finding the squared length of the resulting <strong><code>Vector</code></strong>.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@DistanceSquared: </span><span class="nf">(p1, p2) -&gt;</span>
    <span class="nv">v = </span><span class="nx">Point</span><span class="p">.</span><span class="nx">SubtractPointFromPoint</span><span class="p">(</span><span class="nx">p1</span><span class="p">,</span> <span class="nx">p2</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    </pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <hr />             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <h2><section id='normal'>Normal:</section></h2>

<hr />

<p>A <strong><code>Normal</code></strong> is a <a href="#vector"><strong><code>Vector</code></strong></a> that is perpendicular to a surface at a particular position.
Although they are similar to <strong><code>Vector</code></strong>s, they behave differently in some situations, particularly
when applying transformations.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Normal</span></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <hr />

<h3>Constructor Functions:</h3>             </td>             <td class="code">               <div class="highlight"><pre>  </pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <h3><em>constructor:</em></h3>

<blockquote>
  <p>The standard <strong><code>Normal</code></strong> constructor takes up to three numbers as parameters, representing the <em>X</em>, <em>Y</em> and <em>Z</em> components respectively. Any component that is not set, becomes <code>0</code> by default, therefore, if no arguments are provided, a null <strong><code>Normal</code></strong> is initialised:</p>
  
  <blockquote>
    <p><em>n = (0, 0, 0)</em></p>
  </blockquote>
  
  <p>If any of the components is <code>NaN</code>, an error is thrown.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">constructor: </span><span class="nf">(@x = 0, @y = 0, @z = 0) -&gt;</span>
    <span class="k">if</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">@x</span><span class="p">)</span> <span class="o">or</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">@y</span><span class="p">)</span> <span class="o">or</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">@z</span><span class="p">)</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s">&quot;Normal contains a NaN&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <h3><em>Normal.FromNormal:</em></h3>

<blockquote>
  <p>The <strong><code>Normal</code></strong> class provides a static function for initialising a <strong><code>Normal</code></strong> from another instance of the <strong><code>Normal</code></strong> class.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@FromNormal: </span><span class="nf">(n) -&gt;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Normal</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">n</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">n</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <h3><em>Normal.FromVector:</em></h3>

<blockquote>
  <p>The <strong><code>Normal</code></strong> class provides a static function for initialising a <strong><code>Normal</code></strong> from an instance of the <strong>Vector</strong> class.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@FromVector: </span><span class="nf">(v) -&gt;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Normal</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span>
    </pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <hr />

<h2>Prototypical Instance Functions:</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>These functions are attached to each instance of the <strong><code>Normal</code></strong> class - changing the function of one <strong><code>Normal</code></strong> changes the function on all other <strong><code>Normal</code></strong>s as well. These functions act on a <strong><code>Normal</code></strong> instance in-place - the original object is modified.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <h3><strong>Arithmetic methods</strong></h3>

<p>Arithmetic with <strong><code>Normal</code></strong> instances is performed component-wise, for example:</p>

<blockquote>
  <p><em>n + n' = (n.x + n'.x), (n.y + n'.y), (n.z + n'.z)</em></p>
  
  <p><em>n × 3' = (n.x × 3), (n.y × 3), (n.z × 3)</em></p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  </pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <blockquote>
  <h3><em>add:</em></h3>
  
  <blockquote>
    <p><strong><code>add</code></strong> adds each of the <em>X</em>, <em>Y</em> and <em>Z</em> components of another <strong><code>Normal</code></strong> to the corresponding components of an instance of the <strong>Normal</strong> class.</p>
  </blockquote>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">add: </span><span class="nf">(n) -&gt;</span>
    <span class="nx">@x</span> <span class="o">+=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">x</span>
    <span class="nx">@y</span> <span class="o">+=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">y</span>
    <span class="nx">@z</span> <span class="o">+=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">z</span>
    <span class="k">return</span> <span class="nx">@</span>
    </pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <blockquote>
  <h3><em>subtract:</em></h3>
  
  <blockquote>
    <p><strong><code>subtract</code></strong> subtracts each of the <em>X</em>, <em>Y</em> and <em>Z</em> components of another <strong><code>Normal</code></strong> from the corresponding components of an instance of the <strong><code>Normal</code></strong> class.</p>
  </blockquote>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">subtract: </span><span class="nf">(n) -&gt;</span>
    <span class="nx">@x</span> <span class="o">-=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">x</span>
    <span class="nx">@y</span> <span class="o">-=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">y</span>
    <span class="nx">@z</span> <span class="o">-=</span> <span class="nx">n</span><span class="p">.</span><span class="nx">z</span>
    <span class="k">return</span> <span class="nx">@</span>
  </pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <blockquote>
  <h3><em>multiply:</em></h3>
  
  <blockquote>
    <p><strong><code>multiply</code></strong> multiplies each of the <em>X</em>, <em>Y</em> and <em>Z</em> components of an instance of the <strong><code>Normal</code></strong> class by a given scalar.</p>
  </blockquote>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">multiply: </span><span class="nf">(scale) -&gt;</span>
    <span class="nx">@x</span> <span class="o">*=</span> <span class="nx">scale</span>
    <span class="nx">@y</span> <span class="o">*=</span> <span class="nx">scale</span>
    <span class="nx">@z</span> <span class="o">*=</span> <span class="nx">scale</span>
    <span class="k">return</span> <span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <blockquote>
  <h3><em>divide:</em></h3>
  
  <blockquote>
    <p><strong><code>divide</code></strong> divides each of the <em>X</em>, <em>Y</em> and <em>Z</em> components of an instance of the <strong><code>Normal</code></strong> class by a given scalar.</p>
    
    <p>An error is thrown if the scalar is <code>0</code>.</p>
    
    <p>One division and three multiplications are performed instead of three divisions for efficiency.</p>
  </blockquote>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">divide: </span><span class="nf">(scale) -&gt;</span>
    <span class="k">if</span> <span class="nx">scale</span> <span class="o">is</span> <span class="mi">0</span> 
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s">&quot;Scale value is 0&quot;</span>
    <span class="nv">inv = </span><span class="mi">1</span> <span class="o">/</span> <span class="nx">scale</span>
    <span class="nx">@x</span> <span class="o">*=</span> <span class="nx">inv</span>
    <span class="nx">@y</span> <span class="o">*=</span> <span class="nx">inv</span>
    <span class="nx">@z</span> <span class="o">*=</span> <span class="nx">inv</span>
    <span class="k">return</span> <span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <h3><em>toArray:</em></h3>

<blockquote>
  <p><strong><code>toArray</code></strong> returns a <strong><code>Normal</code></strong> instance as an <code>Array</code> object of the form <code>[X, Y, Z]</code>.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">toArray: </span><span class="o">-&gt;</span>
    <span class="k">return</span> <span class="p">[</span><span class="nx">@x</span><span class="p">,</span> <span class="nx">@y</span><span class="p">,</span> <span class="nx">@z</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <h3><em>equals:</em></h3>

<blockquote>
  <p><strong><code>equals</code></strong> checks a <strong><code>Normal</code></strong> for equality with another <strong><code>Normal</code></strong>. Two <strong><code>Normal</code></strong>s are equal if each of their <em>X</em>, <em>Y</em> and <em>Z</em> components are the same.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">equals: </span><span class="nf">(n) -&gt;</span>
    <span class="k">if</span> <span class="nx">n</span><span class="p">.</span><span class="nx">constructor</span><span class="o">?</span> <span class="o">and</span> <span class="nx">n</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">name</span> <span class="o">is</span> <span class="s">&quot;Normal&quot;</span>
      <span class="k">return</span> <span class="nx">@x</span> <span class="o">is</span> <span class="nx">n</span><span class="p">.</span><span class="nx">x</span> <span class="o">and</span> <span class="nx">@y</span> <span class="o">is</span> <span class="nx">n</span><span class="p">.</span><span class="nx">y</span> <span class="o">and</span> <span class="nx">@z</span> <span class="o">is</span> <span class="nx">n</span><span class="p">.</span><span class="nx">z</span>
    <span class="k">else</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <hr />

<h3>Static Functions:</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>These functions belong to the <strong><code>Normal</code></strong> class - any object arguments are not 
modified and a new object is always returned.</p>             </td>             <td class="code">               <div class="highlight"><pre>  </pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <h3><strong>Arithmetic methods</strong></h3>

<p>Static implementations of basic arithmetic functions are also available. These functions
operate on existing <strong><code>Normal</code></strong> instances.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <blockquote>
  <h3><em>Normal.Add:</em></h3>
  
  <blockquote>
    <p><strong><code>Normal.Add</code></strong> adds each of the <em>X</em>, <em>Y</em> and <em>Z</em> components of another <strong><code>Normal</code></strong> to the corresponding components of an instance of the <strong><code>Normal</code></strong> class.</p>
  </blockquote>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@Add: </span><span class="nf">(n1, n2) -&gt;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Normal</span><span class="p">(</span><span class="nx">n1</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">n2</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">n1</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">n2</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">n1</span><span class="p">.</span><span class="nx">z</span> <span class="o">+</span> <span class="nx">n2</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span>    
  </pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <blockquote>
  <h3><em>Normal.Subtract:</em></h3>
  
  <blockquote>
    <p><strong><code>Normal.Subtract</code></strong> subtracts each of the <em>X</em>, <em>Y</em> and <em>Z</em> components of another <strong><code>Normal</code></strong> from the corresponding components of an instance of the <strong><code>Normal</code></strong> class.</p>
  </blockquote>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@Subtract: </span><span class="nf">(n1, n2) -&gt;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Normal</span><span class="p">(</span><span class="nx">n1</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">n2</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">n1</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">n2</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">n1</span><span class="p">.</span><span class="nx">z</span> <span class="o">-</span> <span class="nx">n2</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <blockquote>
  <h3><em>Normal.Multiply:</em></h3>
  
  <blockquote>
    <p><strong><code>Normal.Multiply</code></strong> multiplies each of the <em>X</em>, <em>Y</em> and <em>Z</em> components of an instance of the <strong><code>Normal</code></strong> class by a given scalar.</p>
  </blockquote>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@Multiply: </span><span class="nf">(n, scale) -&gt;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Normal</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">scale</span><span class="p">,</span> <span class="nx">n</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">scale</span><span class="p">,</span> <span class="nx">n</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="nx">scale</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <blockquote>
  <h3><em>Normal.Divide:</em></h3>
  
  <blockquote>
    <p><strong><code>Normal.Divide</code></strong> divides each of the <em>X</em>, <em>Y</em> and <em>Z</em> components of an instance of the <strong><code>Normal</code></strong> class by a given scalar.</p>
    
      <p>An error is thrown if the scalar is <code>0</code>.</p>
    
    <p>One division and three multiplications are performed instead of three divisions for efficiency.</p>
  </blockquote>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@Divide: </span><span class="nf">(n, scale) -&gt;</span>
    <span class="k">if</span> <span class="nx">scale</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s">&quot;Scale value is 0&quot;</span>
    <span class="nv">inv = </span><span class="mi">1</span> <span class="o">/</span> <span class="nx">scale</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Normal</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">inv</span><span class="p">,</span> <span class="nx">n</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">inv</span><span class="p">,</span> <span class="nx">n</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="nx">inv</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <h3><em>Normal.Negate:</em></h3>

<blockquote>
  <p><strong><code>Normal.Negate</code></strong> returns a <strong><code>Normal</code></strong> that points in the opposite direction to the given <strong><code>Normal</code></strong>, by negating each of the <em>X</em>, <em>Y</em> and <em>Z</em> components.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@Negate: </span><span class="nf">(n) -&gt;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Normal</span><span class="p">(</span><span class="o">-</span><span class="nx">n</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="o">-</span><span class="nx">n</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="o">-</span><span class="nx">n</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <h3><em>Normal.Equals:</em></h3>

<blockquote>
  <p><strong><code>Normal.Equals</code></strong> checks a <strong><code>Normal</code></strong> for equality with another <strong><code>Normal</code></strong>. Two <strong><code>Normal</code></strong>s are equal if each of their <em>X</em>, <em>Y</em> and <em>Z</em> components are the same.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@Equals: </span><span class="nf">(n1, n2) -&gt;</span>
    <span class="k">if</span> <span class="nx">n1</span><span class="p">.</span><span class="nx">constructor</span><span class="o">?</span> <span class="o">and</span> <span class="nx">n1</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">name</span> <span class="o">is</span> <span class="s">&quot;Normal&quot;</span> <span class="o">and</span> <span class="nx">n2</span><span class="p">.</span><span class="nx">constructor</span><span class="o">?</span> <span class="o">and</span> <span class="nx">n2</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">name</span> <span class="o">is</span> <span class="s">&quot;Normal&quot;</span>
      <span class="k">return</span> <span class="nx">n1</span><span class="p">.</span><span class="nx">x</span> <span class="o">is</span> <span class="nx">n2</span><span class="p">.</span><span class="nx">x</span> <span class="o">and</span> <span class="nx">n1</span><span class="p">.</span><span class="nx">y</span> <span class="o">is</span> <span class="nx">n2</span><span class="p">.</span><span class="nx">y</span> <span class="o">and</span> <span class="nx">n1</span><span class="p">.</span><span class="nx">z</span> <span class="o">is</span> <span class="nx">n2</span><span class="p">.</span><span class="nx">z</span>
    <span class="k">else</span> <span class="kc">false</span>
    </pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <h3><em>Normal.Clone:</em></h3>

<blockquote>
  <p><strong><code>Normal.Clone</code></strong> creates an exact copy of a <strong><code>Normal</code></strong>. A Class specific function is used for improved efficiency.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@Clone: </span><span class="nf">(n) -&gt;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Normal</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">n</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">n</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <h3><em>Normal.Dot:</em></h3>

<blockquote>
  <p><strong><code>Normal.Dot</code></strong> computes the <a href="http://en.wikipedia.org/wiki/Dot_product"><strong>Dot Product</strong></a> of two <strong><code>Normal</code></strong> instances - or a <strong><code>Normal</code></strong> and a <strong><code>Vector</code></strong>. The <strong>Dot Product</strong> is defined for <em>a</em> and <em>b</em> as:</p>
  
  <blockquote>
    <p><em>(a.x × b.x) + (a.y × b.y) + (a.z × b.z).</em></p>
  </blockquote>
  
  <p>The <strong>Dot Product</strong> has a simple relationship to the angle between two <strong><code>Normal</code></strong> instances:</p>
  
  <blockquote>
    <p><em>(a &sdot; b) = || a || × || b || × cos(&theta;).</em>  </p>
  </blockquote>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@Dot: </span><span class="nf">(a, b) -&gt;</span>
    <span class="k">return</span> <span class="nx">a</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">b</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">a</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">b</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">a</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="nx">b</span><span class="p">.</span><span class="nx">z</span></pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <h3><em>Normal.AbsDot:</em></h3>

<blockquote>
  <p><strong><code>Normal.AbsDot</code></strong> computes the <a href="http://en.wikipedia.org/wiki/Absolute_value"><strong>Absolute Value</strong></a> of the <strong>Dot Product</strong> of two <strong><code>Normal</code></strong> instances - or a <strong>Normal</strong> and a <strong><code>Vector</code></strong>.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@AbsDot: </span><span class="nf">(a, b) -&gt;</span>
    <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span> <span class="nx">Normal</span><span class="p">.</span><span class="nx">Dot</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span>
    </pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <h3><em>Normal.Normalise:</em></h3>

<blockquote>
  <p><strong><code>Normal.Normalise</code></strong> normalises a <strong><code>Normal</code></strong>, returning a <strong><code>Normal</code></strong> that points in the same direction, but is of unit length.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@Normalise: </span><span class="nf">(n) -&gt;</span>
    <span class="k">return</span> <span class="nx">n</span><span class="p">.</span><span class="nx">divide</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">z</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
  </pre></div>             </td>           </tr>                               <tr id="section-88">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-88">&#182;</a>               </div>               <h3><em>Normal.FaceForward:</em></h3>

<blockquote>
  <p><strong><code>Normal.FaceForward</code></strong> checks if a <strong><code>Normal</code></strong> or a <strong><code>Vector</code></strong> is in the same hemisphere as another <strong><code>Normal</code></strong> or <strong><code>Vector</code></strong> and flips the first <strong><code>Normal</code></strong> or <strong><code>Vector</code></strong> if it isn't. This is useful for ensuring a surface normal is in the same hemisphere as an outgoing <strong><code>Ray</code></strong>.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@FaceForward: </span><span class="nf">(a, b) -&gt;</span>
    <span class="k">return</span> <span class="p">(</span><span class="k">if</span> <span class="nx">Normal</span><span class="p">.</span><span class="nx">Dot</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">then</span> <span class="nx">Normal</span><span class="p">.</span><span class="nx">Negate</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="k">else</span> <span class="nx">a</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-89">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-89">&#182;</a>               </div>               <hr />             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-90">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-90">&#182;</a>               </div>               <h2><section id='ray'>Ray:</section></h2>

<hr />

<p>A <strong><code>Ray</code></strong> is a semi-infinte line specified by its origin and direction. It can be expressed in the parametric form:</p>

<blockquote>
  <p><em>r(t) = origin + t × direction.</em></p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Ray</span>  </pre></div>             </td>           </tr>                               <tr id="section-91">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-91">&#182;</a>               </div>               <h3><em>constructor:</em></h3>

<blockquote>
  <p>A constructor function is defined for creating a new <strong><code>Ray</code></strong> with or without a parent <strong><code>Ray</code></strong>. The <strong><code>Ray</code></strong> constructor takes up to seven parameters:</p>
  
  <ul>
  <li><p><code>origin</code> - the origin <a href="#point"><strong><code>Point</code></strong></a> from where the <strong><code>Ray</code></strong> leaves at time <code>0</code></p></li>
  <li><p><code>direction</code> - the <a href="#vector"><strong><code>Vector</code></strong></a> direction in which the <strong><code>Ray</code></strong> travels</p></li>
  <li><p><code>minTime</code> - the minimum time for the <strong><code>Ray</code></strong> to travel before an intersection. Must be specified if <code>origin</code> and <code>direction</code> are</p></li>
  <li><p><code>parent</code> (optional) - the parent for the <strong><code>Ray</code></strong> - defaults to <code>null</code></p></li>
  <li><p><code>maxTime</code> (optional) - the maximum time for the <strong><code>Ray</code></strong> to travel to find intersections - defaults to <code>Infinity</code>.</p></li>
  <li><p><code>time</code> (optional) - the current time for the <strong><code>Ray</code></strong>, to give a specific vaue along the parametric line - defaults to <code>0</code>.</p></li>
  <li><p><code>depth</code> (optional) - the depth for the <strong><code>Ray</code></strong>, based on how many generations of <strong><code>Ray</code></strong>s come before - defaults to <code>0</code>.</p></li>
  </ul>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">constructor: </span><span class="nf">(@origin, @direction, @minTime, @parent = null, @maxTime = Infinity, @time = 0, @depth = 0) -&gt;</span>
    <span class="k">if</span> <span class="nx">@origin</span><span class="o">?</span> <span class="o">and</span> <span class="nx">@direction</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">@minTime</span><span class="o">?</span>
      <span class="k">throw</span> <span class="nb">Error</span> <span class="s">&quot;If origin and direction and specified, then minTime must be as well.&quot;</span>
    <span class="k">if</span> <span class="nx">@parent</span><span class="o">?</span>
      <span class="vi">@time = </span><span class="nx">@parent</span><span class="p">.</span><span class="nx">time</span>
      <span class="vi">@depth = </span><span class="nx">@parent</span><span class="p">.</span><span class="nx">depth</span> <span class="o">+</span> <span class="mi">1</span>
  </pre></div>             </td>           </tr>                               <tr id="section-92">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-92">&#182;</a>               </div>               <hr />

<h3>Prototypical Instance Functions:</h3>             </td>             <td class="code">               <div class="highlight"><pre> </pre></div>             </td>           </tr>                               <tr id="section-93">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-93">&#182;</a>               </div>               <p>These functions are attached to each instance of the <strong><code>Ray</code></strong> class - changing the function of one <strong><code>Ray</code></strong> changes the function on all other <strong><code>Ray</code></strong>s as well. These functions act on a <strong><code>Ray</code></strong> instance in place - the original object is modified.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-94">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-94">&#182;</a>               </div>               <h3><em>getPoint:</em></h3>

<blockquote>
  <p><strong><code>getPoint</code></strong> returns a new <strong><code>Point</code></strong> along the parameteric description of the <strong><code>Ray</code></strong> at a given time.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">getPoint: </span><span class="nf">(time) -&gt;</span>
    <span class="k">return</span> <span class="nx">Point</span><span class="p">.</span><span class="nx">AddVectorToPoint</span><span class="p">(</span><span class="nx">@origin</span><span class="p">,</span> <span class="nx">@direction</span><span class="p">).</span><span class="nx">multiply</span><span class="p">(</span><span class="nx">time</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-95">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-95">&#182;</a>               </div>               <hr />             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-96">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-96">&#182;</a>               </div>               <h2><section id='raydiff'>RayDifferential:</section></h2>

<hr />

<p>A <strong><code>RayDifferential</code></strong> is a subclass of <a href="#ray"><strong><code>Ray</code></strong></a> that provides additional information about the two <strong><code>Ray</code></strong> instances that offset by one sample in the <em>X</em> and <em>Y</em> directions from the main <strong><code>Ray</code></strong>. It is used to perform better anti-aliasing on textures. </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">RayDifferential</span> <span class="k">extends</span> <span class="nx">Ray</span></pre></div>             </td>           </tr>                               <tr id="section-97">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-97">&#182;</a>               </div>               <hr />

<h3>Constructor Functions:</h3>             </td>             <td class="code">               <div class="highlight"><pre>  </pre></div>             </td>           </tr>                               <tr id="section-98">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-98">&#182;</a>               </div>               <h3><em>constructor:</em></h3>

<blockquote>
  <p>A constructor function is defined for creating a new <strong><code>RayDifferential</code></strong> with or without a parent <strong><code>Ray</code></strong>. The standard <strong><code>RayDifferential</code></strong> constructor takes up to seven parameters:</p>
  
  <ul>
  <li><p><code>origin</code> - the origin <a href="#point"><strong><code>Point</code></strong></a> from where the <strong><code>RayDifferential</code></strong> leaves at time <code>0</code></p></li>
  <li><p><code>direction</code> - the <a href="#vector"><strong><code>Vector</code></strong></a> direction in which the <strong><code>RayDifferential</code></strong> travels</p></li>
  <li><p><code>minTime</code> - the minimum time for the <strong><code>RayDifferential</code></strong> to travel before an intersection. Must be specified if origin and direction are</p></li>
  <li><p><code>parent</code> (optional) - the parent for the <strong><code>RayDifferential</code></strong> - defaults to <code>null</code></p></li>
  <li><p><code>maxTime</code> (optional) - the maximum time for the <strong><code>RayDifferential</code></strong> to travel to find intersections - defaults to <code>Infinity</code></p></li>
  <li><p><code>time</code> (optional) - the current time for the <strong><code>RayDifferential</code></strong>, to give a specific vaue along the parametric line - defaults to <code>0</code></p></li>
  <li><p><code>depth</code> (optional) - the depth for the <strong><code>RayDifferential</code></strong>, based on how many generations of <strong><code>Ray</code></strong> come before - defaults to <code>0</code></p></li>
  </ul>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">constructor: </span><span class="nf">(origin, direction, minTime, parent = null, maxTime = Infinity, time = 0, depth = 0) -&gt;</span>
    <span class="nv">rayDiff = </span><span class="k">new</span> <span class="nx">Ray</span><span class="p">(</span><span class="nx">origin</span><span class="p">,</span> <span class="nx">direction</span><span class="p">,</span> <span class="nx">minTime</span><span class="p">,</span> <span class="nx">parent</span><span class="p">,</span> <span class="nx">maxTime</span><span class="p">,</span> <span class="nx">time</span><span class="p">,</span> <span class="nx">depth</span><span class="p">)</span>
    <span class="nv">rayDiff.hasDifferentials = </span><span class="kc">false</span>
    <span class="nv">rayDiff.rayXOrigin = </span><span class="kc">null</span>
    <span class="nv">rayDiff.rayYOrigin = </span><span class="kc">null</span>
    <span class="nv">rayDiff.rayXDirection = </span><span class="kc">null</span>
    <span class="nv">rayDiff.rayYDirection = </span><span class="kc">null</span>
    <span class="p">(</span><span class="nx">rayDiff</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="k">for</span> <span class="nx">key</span> <span class="k">of</span> <span class="nx">@</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">rayDiff</span>
    </pre></div>             </td>           </tr>                               <tr id="section-99">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-99">&#182;</a>               </div>               <h3><em>RayDifferential.FromRay:</em></h3>

<blockquote>
  <p>The <strong><code>RayDifferential</code></strong> class provides a static function for initialising a <strong><code>RayDifferential</code></strong> from an instance of the <strong><code>Ray</code></strong> class.  </p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@FromRay: </span><span class="nf">(r) -&gt;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">RayDifferential</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">origin</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">direction</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">minTime</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">maxTime</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">time</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">depth</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-100">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-100">&#182;</a>               </div>               <hr />

<h3>Prototypical Instance Functions:</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-101">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-101">&#182;</a>               </div>               <p>These functions are attached to each instance of the <strong><code>RayDifferential</code></strong> class - changing the function of one <strong><code>RayDifferential</code></strong> changes the function on all other <strong><code>RayDifferential</code></strong>s as well. These functions act on a <strong><code>RayDifferential</code></strong> instance in place - the original object is modified.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-102">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-102">&#182;</a>               </div>               <h3><em>scaleDifferentials:</em></h3>

<blockquote>
  <p><strong><code>scaleDifferentials</code></strong> scales the difference betwen the original <strong><code>Ray</code></strong> and its differentials.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">scaleDifferentials: </span><span class="nf">(s) -&gt;</span>
    <span class="vi">@rayXOrigin = </span><span class="nx">Point</span><span class="p">.</span><span class="nx">AddVectorToPoint</span> <span class="nx">@origin</span><span class="p">,</span> <span class="nx">Point</span><span class="p">.</span><span class="nx">SubtractPointFromPoint</span><span class="p">(</span><span class="nx">@rayXOrigin</span><span class="p">,</span> <span class="nx">@origin</span><span class="p">).</span><span class="nx">multiply</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
    <span class="vi">@rayYOrigin = </span><span class="nx">Point</span><span class="p">.</span><span class="nx">AddVectorToPoint</span> <span class="nx">@origin</span><span class="p">,</span> <span class="nx">Point</span><span class="p">.</span><span class="nx">SubtractPointFromPoint</span><span class="p">(</span><span class="nx">@rayYOrigin</span><span class="p">,</span> <span class="nx">@origin</span><span class="p">).</span><span class="nx">multiply</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
    <span class="vi">@rayXDirection = </span><span class="nx">Vector</span><span class="p">.</span><span class="nx">Add</span> <span class="nx">@direction</span><span class="p">,</span> <span class="nx">Vector</span><span class="p">.</span><span class="nx">Subtract</span><span class="p">(</span><span class="nx">@rayXDirection</span><span class="p">,</span> <span class="nx">@direction</span><span class="p">).</span><span class="nx">multiply</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
    <span class="vi">@rayYDirection = </span><span class="nx">Vector</span><span class="p">.</span><span class="nx">Add</span> <span class="nx">@direction</span><span class="p">,</span> <span class="nx">Vector</span><span class="p">.</span><span class="nx">Subtract</span><span class="p">(</span><span class="nx">@rayYDirection</span><span class="p">,</span> <span class="nx">@direction</span><span class="p">).</span><span class="nx">multiply</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
   </pre></div>             </td>           </tr>                               <tr id="section-103">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-103">&#182;</a>               </div>               <hr />             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-104">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-104">&#182;</a>               </div>               <h2><section id='bbox'>BoundingBox:</section></h2>

<hr />

<p>A <strong>BoundingBox</strong> is a 3-dimensional bounding volume that encloses an object. It is used to avoid doing unnecessary computation - for example, if a <a href="#ray"><strong><code>Ray</code></strong></a> doesn't pass through a <strong><code>BoundingBox</code></strong>, then there is no need to process any intersections with any of the objects inside the <strong><code>BoundingBox</code></strong>. </p>

<p>A <strong><code>BoundingBox</code></strong> is defined by two corner <a href="#point"><strong><code>Point</code></strong></a> instances, which implicitly describe the whole box.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">BoundingBox</span></pre></div>             </td>           </tr>                               <tr id="section-105">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-105">&#182;</a>               </div>               <h3><em>constructor:</em></h3>

<blockquote>
  <p>A constructor function is defined for creating a new <strong><code>BoundingBox</code></strong> when given up to two <strong><code>Point</code></strong>s. </p>
  
  <p>When given two arguments, the constructor returns a <strong><code>BoundingBox</code></strong> with <code>pMin</code> set to the minimum <em>X</em>, <em>Y</em> and <em>Z</em> values from both <strong><code>Point</code></strong>s, and with <code>pMax</code> set to the maximum <em>X</em>, <em>Y</em> and <em>Z</em> values from both <strong><code>Point</code></strong>s.</p>
  
  <p>When given a single argument, the constructor returns a <strong><code>BoundingBox</code></strong> that contains just that one <strong><code>Point</code></strong>.</p>
  
  <p>When given no arguments, the constructor returns a <strong><code>BoundingBox</code></strong> with <code>pMin</code> set to <code>Infinity</code>, and <code>pMax</code> set to <code>-Infinity</code>, which seems counter-intuitive but ensures correct behavious on operations like <strong><code>Union</code></strong> work correctly on the empty <strong><code>BoundingBox</code></strong>.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">constructor: </span><span class="nf">(p1, p2) -&gt;</span>
    <span class="k">if</span> <span class="nx">p1</span><span class="o">?</span> <span class="o">and</span> <span class="nx">p2</span><span class="o">?</span>
      <span class="vi">@pMin = </span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p2</span><span class="p">.</span><span class="nx">x</span><span class="p">),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">p2</span><span class="p">.</span><span class="nx">y</span><span class="p">),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">p1</span><span class="p">.</span><span class="nx">z</span><span class="p">,</span> <span class="nx">p2</span><span class="p">.</span><span class="nx">z</span><span class="p">))</span>
      <span class="vi">@pMax = </span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p2</span><span class="p">.</span><span class="nx">x</span><span class="p">),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">p2</span><span class="p">.</span><span class="nx">y</span><span class="p">),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">p1</span><span class="p">.</span><span class="nx">z</span><span class="p">,</span> <span class="nx">p2</span><span class="p">.</span><span class="nx">z</span><span class="p">))</span>
    
    <span class="k">else</span> <span class="k">if</span> <span class="nx">p1</span><span class="o">?</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">p2</span><span class="o">?</span> <span class="k">then</span> <span class="k">return</span> <span class="k">new</span> <span class="nx">BoundingBox</span><span class="p">(</span><span class="nx">p1</span><span class="p">,</span> <span class="nx">p1</span><span class="p">)</span>
    <span class="k">else</span> <span class="k">if</span> <span class="o">not</span> <span class="nx">p1</span><span class="o">?</span> <span class="o">and</span> <span class="nx">p2</span><span class="o">?</span> <span class="k">then</span> <span class="k">return</span> <span class="k">new</span> <span class="nx">BoundingBox</span><span class="p">(</span><span class="nx">p2</span><span class="p">,</span> <span class="nx">p2</span><span class="p">)</span>
    
    <span class="k">else</span>
      <span class="vi">@pMin = </span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="kc">Infinity</span><span class="p">,</span> <span class="kc">Infinity</span><span class="p">,</span> <span class="kc">Infinity</span><span class="p">)</span>
      <span class="vi">@pMax = </span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="o">-</span><span class="kc">Infinity</span><span class="p">,</span> <span class="o">-</span><span class="kc">Infinity</span><span class="p">,</span> <span class="o">-</span><span class="kc">Infinity</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-106">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-106">&#182;</a>               </div>               <hr />

<h3>Prototypical Instance Functions:</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-107">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-107">&#182;</a>               </div>               <p>These functions are attached to each instance of the <strong><code>BoundingBox</code></strong> class - changing the function of one <strong><code>BoundingBox</code></strong> changes the function on all other <strong><code>BoundingBox</code></strong>s as well. These functions act on a <strong><code>BoundingBox</code></strong> instance in place - the original object is modified.</p>             </td>             <td class="code">               <div class="highlight"><pre>  </pre></div>             </td>           </tr>                               <tr id="section-108">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-108">&#182;</a>               </div>               <h3><em>expand:</em></h3>

<blockquote>
  <p><strong><code>expand</code></strong> pads the original <strong><code>BoundingBox</code></strong> instance by a constant factor <code>delta</code> in all directions.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">expand: </span><span class="nf">(delta) -&gt;</span>
    <span class="nx">@pMin</span><span class="p">.</span><span class="nx">subtractVector</span> <span class="k">new</span> <span class="nx">Vector</span><span class="p">(</span><span class="nx">delta</span><span class="p">,</span> <span class="nx">delta</span><span class="p">,</span> <span class="nx">delta</span><span class="p">)</span>
    <span class="nx">@pMax</span><span class="p">.</span><span class="nx">addVector</span> <span class="k">new</span> <span class="nx">Vector</span><span class="p">(</span><span class="nx">delta</span><span class="p">,</span> <span class="nx">delta</span><span class="p">,</span> <span class="nx">delta</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-109">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-109">&#182;</a>               </div>               <h3><em>surfaceArea:</em></h3>

<blockquote>
  <p><strong><code>surfaceArea</code></strong> returns the total surface area of the six faces of the original <strong><code>BoundingBox</code></strong> instance.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">surfaceArea: </span><span class="o">-&gt;</span>
    <span class="nv">d = </span><span class="nx">Point</span><span class="p">.</span><span class="nx">SubtractPointFromPoint</span> <span class="nx">@pMax</span><span class="p">,</span> <span class="nx">@pMin</span>
    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">d</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">d</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">d</span><span class="p">.</span><span class="nx">z</span> <span class="o">+</span> <span class="nx">d</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">d</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-110">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-110">&#182;</a>               </div>               <h3><em>volume:</em></h3>

<blockquote>
  <p><strong><code>volume</code></strong> returns the total internal volume of the original <strong><code>BoundingBox</code></strong> instance.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">volume: </span><span class="o">-&gt;</span>
    <span class="nv">d = </span><span class="nx">Point</span><span class="p">.</span><span class="nx">SubtractPointFromPoint</span> <span class="nx">@pMax</span><span class="p">,</span> <span class="nx">@pMin</span>
    <span class="k">return</span> <span class="nx">d</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">d</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">d</span><span class="p">.</span><span class="nx">z</span>
  </pre></div>             </td>           </tr>                               <tr id="section-111">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-111">&#182;</a>               </div>               <h3><em>maximumExtent:</em></h3>

<blockquote>
  <p><strong><code>maximumExtent</code></strong> returns which of the tree lengths of the original <strong><code>BoundingBox</code></strong> instance is longest.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">maximumExtent: </span><span class="o">-&gt;</span>
    <span class="nv">d = </span><span class="nx">Point</span><span class="p">.</span><span class="nx">SubtractPointFromPoint</span> <span class="nx">@pMax</span><span class="p">,</span> <span class="nx">@pMin</span>
    <span class="k">if</span> <span class="nx">d</span><span class="p">.</span><span class="nx">x</span> <span class="o">&gt;</span> <span class="nx">d</span><span class="p">.</span><span class="nx">y</span> <span class="o">and</span> <span class="nx">d</span><span class="p">.</span><span class="nx">x</span> <span class="o">&gt;</span> <span class="nx">d</span><span class="p">.</span><span class="nx">z</span> <span class="k">then</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">d</span><span class="p">.</span><span class="nx">y</span> <span class="o">&gt;</span> <span class="nx">d</span><span class="p">.</span><span class="nx">z</span> <span class="k">then</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">return</span> <span class="mi">2</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-112">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-112">&#182;</a>               </div>               <h3><em>toArray:</em></h3>

<blockquote>
  <p><strong><code>toArray</code></strong> returns the original <strong><code>BoundingBox</code></strong> instance as an <code>Array</code> object of the form <code>[pMin, pMax]</code>. </p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">toArray: </span><span class="o">-&gt;</span>
    <span class="k">return</span> <span class="p">[</span><span class="nx">@pMin</span><span class="p">,</span> <span class="nx">@pMax</span><span class="p">]</span>
  </pre></div>             </td>           </tr>                               <tr id="section-113">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-113">&#182;</a>               </div>               <h3><em>boundingSphere:</em></h3>

<blockquote>
  <p><strong><code>boundingSphere</code></strong> returns the center and radius of a sphere that competely encapsulates this <strong><code>BoundingBox</code></strong>.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">boundingSphere: </span><span class="o">-&gt;</span>
    <span class="nv">center = </span><span class="nx">Point</span><span class="p">.</span><span class="nx">AddPointToPoint</span> <span class="nx">Point</span><span class="p">.</span><span class="nx">Multiply</span><span class="p">(</span><span class="nx">@pMin</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="nx">Point</span><span class="p">.</span><span class="nx">Multiply</span><span class="p">(</span><span class="nx">@pMax</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="nv">radius = </span><span class="k">if</span> <span class="nx">BoundingBox</span><span class="p">.</span><span class="nx">Inside</span> <span class="k">this</span><span class="p">,</span> <span class="nx">center</span> <span class="k">then</span> <span class="nx">Point</span><span class="p">.</span><span class="nx">Distance</span> <span class="nx">center</span><span class="p">,</span> <span class="nx">@pMax</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="p">[</span><span class="nx">center</span><span class="p">,</span> <span class="nx">radius</span><span class="p">]</span>
  </pre></div>             </td>           </tr>                               <tr id="section-114">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-114">&#182;</a>               </div>               <hr />

<h3>Static Functions:</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-115">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-115">&#182;</a>               </div>               <p>These functions belong to the <strong><code>BoundingBox</code></strong> class - any object arguments are not 
modified and a new object is always returned.</p>             </td>             <td class="code">               <div class="highlight"><pre>      </pre></div>             </td>           </tr>                               <tr id="section-116">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-116">&#182;</a>               </div>               <h3><em>BoundingBox.UnionBBoxAndPoint:</em></h3>

<blockquote>
  <p><strong><code>BoundingBox.UnionBBoxAndPoint</code></strong> returns a new <strong><code>BoundingBox** that encompasses a given **</code>BoundingBox<code>** and **</code>Point`</strong>.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@UnionBBoxAndPoint: </span><span class="nf">(bbox, p) -&gt;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">BoundingBox</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">bbox</span><span class="p">.</span><span class="nx">pMin</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="p">),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">bbox</span><span class="p">.</span><span class="nx">pMin</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="p">),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">bbox</span><span class="p">.</span><span class="nx">pMin</span><span class="p">.</span><span class="nx">z</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span class="p">)),</span>
                           <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">bbox</span><span class="p">.</span><span class="nx">pMax</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="p">),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">bbox</span><span class="p">.</span><span class="nx">pMax</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="p">),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">bbox</span><span class="p">.</span><span class="nx">pMax</span><span class="p">.</span><span class="nx">z</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span><span class="p">)))</span>
  </pre></div>             </td>           </tr>                               <tr id="section-117">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-117">&#182;</a>               </div>               <h3><em>BoundingBox.UnionBBoxAndBBox:</em></h3>

<blockquote>
  <p><strong><code>BoundingBox.UnionBBoxAndBBox</code></strong> returns a new <strong><code>BoundingBox</code></strong> that encompasses a two given <strong><code>BoundingBox</code></strong> instances.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@UnionBBoxAndBBox: </span><span class="nf">(bbox1, bbox2) -&gt;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">BoundingBox</span><span class="p">(</span><span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">bbox1</span><span class="p">.</span><span class="nx">pMin</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">bbox2</span><span class="p">.</span><span class="nx">pMin</span><span class="p">.</span><span class="nx">x</span><span class="p">),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">bbox1</span><span class="p">.</span><span class="nx">pMin</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">bbox2</span><span class="p">.</span><span class="nx">pMin</span><span class="p">.</span><span class="nx">y</span><span class="p">),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">bbox1</span><span class="p">.</span><span class="nx">pMin</span><span class="p">.</span><span class="nx">z</span><span class="p">,</span> <span class="nx">bbox2</span><span class="p">.</span><span class="nx">pMin</span><span class="p">.</span><span class="nx">z</span><span class="p">)),</span>
                           <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">bbox1</span><span class="p">.</span><span class="nx">pMax</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">bbox2</span><span class="p">.</span><span class="nx">pMax</span><span class="p">.</span><span class="nx">x</span><span class="p">),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">bbox1</span><span class="p">.</span><span class="nx">pMax</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">bbox2</span><span class="p">.</span><span class="nx">pMax</span><span class="p">.</span><span class="nx">y</span><span class="p">),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">bbox1</span><span class="p">.</span><span class="nx">pMax</span><span class="p">.</span><span class="nx">z</span><span class="p">,</span> <span class="nx">bbox2</span><span class="p">.</span><span class="nx">pMax</span><span class="p">.</span><span class="nx">z</span><span class="p">)))</span>
  </pre></div>             </td>           </tr>                               <tr id="section-118">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-118">&#182;</a>               </div>               <h3><em>BoundingBox.Equals:</em></h3>

<blockquote>
  <p><strong><code>BoundingBox.Equals</code></strong> checks if two <strong><code>BoundingBox</code></strong>es are equal to one another. Two <strong><code>BoundingBox</code></strong>es are equal if both of their <code>pMin</code> components are the same, and both of their <code>pMax</code> components are the same.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@Equals: </span><span class="nf">(bbox1, bbox2) -&gt;</span>
    <span class="k">if</span> <span class="nx">bbox1</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">name</span> <span class="o">is</span> <span class="s">&quot;BoundingBox&quot;</span> <span class="o">and</span> <span class="nx">bbox2</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">name</span> <span class="o">is</span> <span class="s">&quot;BoundingBox&quot;</span>
      <span class="k">return</span> <span class="nx">Point</span><span class="p">.</span><span class="nx">Equals</span><span class="p">(</span><span class="nx">bbox1</span><span class="p">.</span><span class="nx">pMin</span><span class="p">,</span> <span class="nx">bbox2</span><span class="p">.</span><span class="nx">pMin</span><span class="p">)</span> <span class="o">and</span> <span class="nx">Point</span><span class="p">.</span><span class="nx">Equals</span><span class="p">(</span><span class="nx">bbox1</span><span class="p">.</span><span class="nx">pMax</span><span class="p">,</span> <span class="nx">bbox2</span><span class="p">.</span><span class="nx">pMax</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">false</span>
    </pre></div>             </td>           </tr>                               <tr id="section-119">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-119">&#182;</a>               </div>               <h3><em>BoundingBox.Overlaps:</em></h3>

<blockquote>
  <p><strong><code>BoundingBox.Overlaps</code></strong> checks if two <strong><code>BoundingBox</code></strong>es overlap one another.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@Overlaps: </span><span class="nf">(bbox1, bbox2) -&gt;</span>
    <span class="k">return</span> <span class="p">((</span><span class="nx">bbox1</span><span class="p">.</span><span class="nx">pMax</span><span class="p">.</span><span class="nx">x</span> <span class="o">&gt;=</span> <span class="nx">bbox2</span><span class="p">.</span><span class="nx">pMin</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="o">and</span> <span class="p">(</span><span class="nx">bbox1</span><span class="p">.</span><span class="nx">pMin</span><span class="p">.</span><span class="nx">x</span> <span class="o">&lt;=</span> <span class="nx">bbox2</span><span class="p">.</span><span class="nx">pMax</span><span class="p">.</span><span class="nx">x</span><span class="p">))</span> <span class="o">and</span> 
           <span class="p">((</span><span class="nx">bbox1</span><span class="p">.</span><span class="nx">pMax</span><span class="p">.</span><span class="nx">y</span> <span class="o">&gt;=</span> <span class="nx">bbox2</span><span class="p">.</span><span class="nx">pMin</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span> <span class="o">and</span> <span class="p">(</span><span class="nx">bbox1</span><span class="p">.</span><span class="nx">pMin</span><span class="p">.</span><span class="nx">y</span> <span class="o">&lt;=</span> <span class="nx">bbox2</span><span class="p">.</span><span class="nx">pMax</span><span class="p">.</span><span class="nx">y</span><span class="p">))</span> <span class="o">and</span> 
           <span class="p">((</span><span class="nx">bbox1</span><span class="p">.</span><span class="nx">pMax</span><span class="p">.</span><span class="nx">z</span> <span class="o">&gt;=</span> <span class="nx">bbox2</span><span class="p">.</span><span class="nx">pMin</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="o">and</span> <span class="p">(</span><span class="nx">bbox1</span><span class="p">.</span><span class="nx">pMin</span><span class="p">.</span><span class="nx">z</span> <span class="o">&lt;=</span> <span class="nx">bbox2</span><span class="p">.</span><span class="nx">pMax</span><span class="p">.</span><span class="nx">z</span><span class="p">))</span>
  </pre></div>             </td>           </tr>                               <tr id="section-120">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-120">&#182;</a>               </div>               <h3><em>BoundingBox.Inside:</em></h3>

<blockquote>
  <p><strong><code>BoundingBox.Inside</code></strong> checks if a <strong><code>Point</code></strong> lies inside a given <strong><code>BoundingBox</code></strong>.         </p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@Inside: </span><span class="nf">(bbox, p) -&gt;</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">x</span> <span class="o">&gt;=</span> <span class="nx">bbox</span><span class="p">.</span><span class="nx">pMin</span><span class="p">.</span><span class="nx">x</span> <span class="o">and</span> <span class="nx">p</span><span class="p">.</span><span class="nx">x</span> <span class="o">&lt;=</span> <span class="nx">bbox</span><span class="p">.</span><span class="nx">pMax</span><span class="p">.</span><span class="nx">x</span> <span class="o">and</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span> <span class="o">&gt;=</span> <span class="nx">bbox</span><span class="p">.</span><span class="nx">pMin</span><span class="p">.</span><span class="nx">y</span> <span class="o">and</span> <span class="nx">p</span><span class="p">.</span><span class="nx">y</span> <span class="o">&lt;=</span> <span class="nx">bbox</span><span class="p">.</span><span class="nx">pMax</span><span class="p">.</span><span class="nx">y</span> <span class="o">and</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span> <span class="o">&gt;=</span> <span class="nx">bbox</span><span class="p">.</span><span class="nx">pMin</span><span class="p">.</span><span class="nx">z</span> <span class="o">and</span> <span class="nx">p</span><span class="p">.</span><span class="nx">z</span> <span class="o">&lt;=</span> <span class="nx">bbox</span><span class="p">.</span><span class="nx">pMax</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-121">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-121">&#182;</a>               </div>               <h3><em>BoundingBox.LinearInterpolation:</em></h3>

<blockquote>
  <p><strong><code>BoundingBox.LinearInterpolation</code></strong> linearly interpolates between the corners of a given <strong><code>BoundingBox</code></strong>, where <code>bbox.pMin</code> has an offset of <code>(0, 0, 0)</code> and <code>bbox.pMax</code> has an offset of <code>(1, 1, 1)</code>.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@LinearInterpolation: </span><span class="nf">(bbox, tx, ty, tz) -&gt;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">MathFunctions</span><span class="p">.</span><span class="nx">LinearInterpolation</span><span class="p">(</span><span class="nx">tx</span><span class="p">,</span> <span class="nx">bbox</span><span class="p">.</span><span class="nx">pMin</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">bbox</span><span class="p">.</span><span class="nx">pMax</span><span class="p">.</span><span class="nx">x</span><span class="p">),</span>
                     <span class="nx">MathFunctions</span><span class="p">.</span><span class="nx">LinearInterpolation</span><span class="p">(</span><span class="nx">ty</span><span class="p">,</span> <span class="nx">bbox</span><span class="p">.</span><span class="nx">pMin</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">bbox</span><span class="p">.</span><span class="nx">pMax</span><span class="p">.</span><span class="nx">y</span><span class="p">),</span>
                     <span class="nx">MathFunctions</span><span class="p">.</span><span class="nx">LinearInterpolation</span><span class="p">(</span><span class="nx">tz</span><span class="p">,</span> <span class="nx">bbox</span><span class="p">.</span><span class="nx">pMin</span><span class="p">.</span><span class="nx">z</span><span class="p">,</span> <span class="nx">bbox</span><span class="p">.</span><span class="nx">pMax</span><span class="p">.</span><span class="nx">z</span><span class="p">))</span>
  </pre></div>             </td>           </tr>                               <tr id="section-122">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-122">&#182;</a>               </div>               <h3><em>BoundingBox.Offset:</em></h3>

<blockquote>
  <p><strong><code>BoundingBox.Offset</code></strong> returns the offset of a point against a given <strong><code>BoundingBox</code></strong>, where <code>(0, 0, 0)</code> represents <code>bbox.pMin</code>, and <code>(1, 1, 1)</code> represents <code>bbox.pMax</code>.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@Offset: </span><span class="nf">(bbox, p) -&gt;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Vector</span><span class="p">((</span><span class="nx">p</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">bbox</span><span class="p">.</span><span class="nx">pMin</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nx">bbox</span><span class="p">.</span><span class="nx">pMax</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">bbox</span><span class="p">.</span><span class="nx">pMin</span><span class="p">.</span><span class="nx">x</span><span class="p">),</span>
                      <span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">bbox</span><span class="p">.</span><span class="nx">pMin</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nx">bbox</span><span class="p">.</span><span class="nx">pMax</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">bbox</span><span class="p">.</span><span class="nx">pMin</span><span class="p">.</span><span class="nx">y</span><span class="p">),</span>
                      <span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">z</span> <span class="o">-</span> <span class="nx">bbox</span><span class="p">.</span><span class="nx">pMin</span><span class="p">.</span><span class="nx">z</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nx">bbox</span><span class="p">.</span><span class="nx">pMax</span><span class="p">.</span><span class="nx">z</span> <span class="o">-</span> <span class="nx">bbox</span><span class="p">.</span><span class="nx">pMin</span><span class="p">.</span><span class="nx">z</span><span class="p">))</span>
                      </pre></div>             </td>           </tr>                               <tr id="section-123">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-123">&#182;</a>               </div>               <hr />

<h2>Exports:</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-124">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-124">&#182;</a>               </div>               <p>The <a href="#vector"><strong><code>Vector</code></strong></a>, <a href="#point"><strong><code>Point</code></strong></a>, <a href="#normal"><strong><code>Normal</code></strong></a>, <a href="#ray"><strong><code>Ray</code></strong></a>, <a href="#raydiff"><strong><code>RayDifferential</code></strong></a> and <a href="#bbox"><strong><code>BoundingBox</code></strong></a> classes are added to the global <code>root</code> object.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">root = </span><span class="nx">exports</span> <span class="o">?</span> <span class="k">this</span>
<span class="nv">root.Vector = </span><span class="nx">Vector</span>
<span class="nv">root.Point = </span><span class="nx">Point</span>
<span class="nv">root.Normal = </span><span class="nx">Normal</span>
<span class="nv">root.Ray = </span><span class="nx">Ray</span>
<span class="nv">root.RayDifferential = </span><span class="nx">RayDifferential</span>
<span class="nv">root.BoundingBox = </span><span class="nx">BoundingBox</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 